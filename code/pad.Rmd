---
title: "PAD-ATA Call Log Analysis"
output:
  word_document: default
  html_notebook: default
  pdf_document: default
---

#### Libraries used in the Project and uploading data

```{r}
library(tidyverse)
library(dplyr)
library(stringr)
library(svMisc)
library(ggplot2)
library(gtable)
library("ggpubr")

log_data <- read_csv("~/Desktop/PAE/github/data/logData.csv")
#log_data <- read_csv("~/Desktop/PAE/github/data/benData_weakCallers.csv")

log_data_saver <- log_data

log_data <- unique(log_data)

log_data$logInfo <- str_replace(log_data$logInfo, "  ", " ")

#MAKE IT ALL UPPER!!!

log_data$logInfo <- toupper(log_data$logInfo)

### GETTING THE DATE MONTH AND YEAR IF I WANT!!!
extractdate <- function(date) {
    day <- format(date, format="%d")
    month <- format(date, format="%m")
    year <- format(date, format="%Y")

    cbind(day, month, year)
}

#making first calls
first_call<-extractdate(log_data$callTime)


#making last call
last_day <-substr(log_data$eventTime, 9, 10)
last_month <- substr(log_data$eventTime, 6, 7)
last_year <-substr(log_data$eventTime, 1, 4)

log_data<-cbind(log_data, first_call,last_day,last_month,last_year)

#Converting columns to numeric
log_data$day <-as.numeric(log_data$day)
log_data$last_day <- as.numeric(log_data$last_day)
log_data$month <-as.numeric(log_data$month)
log_data$last_month <- as.numeric(log_data$last_month)
log_data$year <- as.numeric(log_data$year)
log_data$last_year <- as.numeric(log_data$last_year )


log_data$year <- log_data$year +log_data$month/12
log_data$last_year <- log_data$last_year + log_data$last_month/12

log_data$caller_lifetime <- log_data$last_year - log_data$year
```

*Cmd+Option+I*.

 *Cmd+Shift+K* 
 
### PRELIMINARY DISTRIBUTIONS
 
**In this section, we display some of the basic distributions of the data including languages, total lifeetime of a given caller, colls made, content accessed, and the ratio of content listened to calls made.**

**Based on the graphs below, we are nervous that some of the data is not random given the incredibly high ratio for content listened to calls made, but given that the data is distributed fairly evenly across thee different graphs, we are unsure**

```{r}
lang_spoken <- log_data %>%
  group_by(callerId, langId) %>%
  count()

#Distribution of languages spoken
ggplot(data=lang_spoken, aes(x=langId)) +
  geom_bar(fill='red')+
  ylim(0,600)+
  labs(
    title = 'Distribution of Languages by Caller
    1 = Amharic, 2=Oromiffa, 3=Tigrigna, 4=Wolayitta, and 5=Sidamigna',
    x = 'Language',
    y= 'count'
  )


#Distribution of time difference bewtween first and last call

lifetime<- log_data %>%
  group_by(callerId, caller_lifetime) %>%
  count()

ggplot(data=lifetime, aes(x=caller_lifetime)) +
  geom_histogram(fill='brown', color='black')+
  labs(
    title = 'Distribution of Call Lifetimes',
    x = 'Years between First and Last Call',
    y= 'count'
  )

#distribution of calls made

calls_made <- log_data %>%
  group_by(callerId, noCallsMade) %>%
  count()

ggplot(calls_made, aes(x=noCallsMade)) +
  geom_histogram(color="black", fill="blue") +
  xlim(0,350) +
  labs(
    title = 'Distribution of calls made per individual over lifetime (Outliers Excluded) \n
Min. 1st Qu.  Median  Mean   3rd Qu.    Max. 
    3.0    45.0    69.0     99.9    106.0    7110.0 ',
    x = 'Total number of calls'
  )

content_listened <- filter(log_data, grepl("CONTENT",logInfo))
content_listened <- filter(content_listened , !grepl("CONTENT MENU",logInfo))
content_listened <- filter(content_listened , !grepl("CONTENT IS NOT AVAILABLE",logInfo))

#Creating a content#_played column
content_listened$content_played <- ifelse(str_detect(content_listened$logInfo, 'CONTENT PLAYED', negate = FALSE),1,0)
content_listened$replay_request <- ifelse(str_detect(content_listened$logInfo, 'CONTENT REPLAY REQUESTED', negate = FALSE),1,0)

content_played<-aggregate(content_listened$content_played,list(content_listened$callerId), FUN=sum)
?rename
content_played <- content_played %>% 
  dplyr::rename(
    con_play = x,
    callerId = Group.1
    )

content_replay<-aggregate(content_listened$replay_request,list(content_listened$callerId), FUN=sum)
content_replay <- content_replay %>% 
 dplyr::rename(
    con_replay = x,
    callerId = Group.1
    )

content_counts <- cbind(content_played, content_replay)

content_counts$adjusted_con <- content_counts$con_play-content_counts$con_replay

content_counts$callerId <- NULL

summary(content_counts$adjusted_con)


#graphing the true distribution of content played
ggplot(content_counts, aes(x=adjusted_con)) +
  geom_histogram(color="black", fill="green") +
  xlim(0,100) +
  labs(
    title = 'Distribution of total Content listened to all Across all Calls (Outliers Excluded) \n
      Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
   0.00    3.00    8.00   17.79   20.00  279.00 ',
    x = 'Total Content Listen Across Calls'
  )


# Getting the number of calls per person
calls_made <- log_data %>%
  dplyr::group_by(callId) %>%
  count()

calls_made_id <- log_data %>%
  dplyr::group_by(callId, callerId) %>%
  count()


#join between tables
content_ratio <- left_join(calls_made_id, content_counts,by="callerId")
content_ratio[is.na(content_ratio)] <- 0

content_ratio <- content_ratio %>%
  dplyr::group_by(callerId, con_play, con_replay, adjusted_con) %>%
  count()

content_ratio$ratio <- content_ratio$adjusted_con/content_ratio$n

summary(content_ratio$ratio)

ggplot(content_ratio, aes(x=ratio)) +
  geom_histogram(color="black", fill="red") +
  xlim(0,2)+
  labs(
    title = 'Distribution of ratio of content listened to Calls (Outliers Excluded) \n
Min. 1st Qu.  Median    Mean 3rd Qu.    Max.     
 0.0000  0.5614  1.0000  1.2500  1.5292 13.4000 ',
    x = 'Content to Call Ratio'
  )


sum(content_ratio$n)
```
```{r}
lifetime<- log_data %>%
  group_by(callerId, caller_lifetime) %>%
  count()

ggplot(data=lifetime, aes(x=caller_lifetime)) +
  geom_histogram(fill='#c7d0d8', color='black')+
  theme(plot.background = element_rect(fill = "#fcfff9"),
        panel.background = element_rect(fill = "#fcfff9"),
        panel.grid.major = element_line(size=.1,colour = "black"),
        panel.grid.minor = element_line(size=.1,colour = "black"),)+
  labs(
    title = 'Distribution of Call Lifetimes (2014 - 2020)',
    x = 'Years Between First and Last Call',
    y= 'Frequency'
  )

lang_spoken <- log_data %>%
  group_by(callerId, langId) %>%
  count()

lang_spoken$langId <- ifelse(lang_spoken$langId == 1, 'AMHARIC', lang_spoken$langId)
lang_spoken$langId <- ifelse(lang_spoken$langId == 2, 'OROMIFFA', lang_spoken$langId)
lang_spoken$langId <- ifelse(lang_spoken$langId == 3, 'TIGRIGNA', lang_spoken$langId)
lang_spoken$langId <- ifelse(lang_spoken$langId == 4, 'WOLAYITTA', lang_spoken$langId)
lang_spoken$langId <- ifelse(lang_spoken$langId == 5, 'SIDAMIGNA', lang_spoken$langId)
                             
#Distribution of languages spoken
ggplot(data=lang_spoken, aes(x=langId)) +
  geom_bar(color='black',fill='#19723f')+
  ylim(0,600)+
    theme(
         plot.background = element_rect(fill = "#fcfff9"),
        panel.background = element_rect(fill = "#fcfff9"),
        panel.grid.major = element_line(size=.1,colour = "black"),
        panel.grid.minor = element_line(size=.1,colour = "black"),
        panel.grid.major.x = element_blank(),
         panel.grid.minor.x = element_blank())+
  labs(
    title = 'Distribution of Languages by Caller',
    x = 'Language',
    y= 'Frequency'
  )
```

### TOP MENU

**Next, we want to Breakd down the initial Menu options and delve into the distributions of the selections that the farmer can make at a different state in the IVR System**

**For the first analysis, we looked at the distribution of the TOP MENU in the data. This comes in as follows**:

##### INCOMING CALL STARTED --> WELCOME MESSAGE PLAYED --> ASSINGED TO EXPERIMENT (OPTIONAL) --> TOP MENU

**TOP MENU**

 - RAIN OPTION
 - HHI OPTION (household Irrigation)
 - RESET PROFILE OPTION
 - TOP MENU REPLAY
 - LIVESTOCK OPTION 
 - COVID OPTION
 
 *Please note, we are unsure of the order these are presented. For other menus, we do have the order*
 
 **Below, we have visualized the number of farmers, out of our sample, that in the life time of their calling history have accessed a given TOP MENU item at least once**
 
 **Additionally, we also visualized this same selection divided by language to see if the patterns of seleciont are similar or different across langauges**v
 
```{r}
#STARTING HERE IS FOR UNIQUE CALLERS
# filtering out top Menu keys

top_menu <-filter(log_data, grepl("TOP MENU",logInfo))

#cleaning the axis
top_menu$logInfo<- str_replace(top_menu$logInfo, "TOP MENU - ", "")
top_menu$logInfo<- str_replace(top_menu$logInfo, " PRESSED", "")
top_menu$logInfo<- str_replace(top_menu$logInfo, " PRESSED", "")
top_menu$logInfo<- str_replace(top_menu$logInfo, " SELECTED", "")

top_menu <- top_menu %>%
  group_by(callerId, logInfo, langId) %>%
  count()


ggplot(top_menu, aes(logInfo)) +
  theme(axis.text.x = element_text(angle = 30, hjust =1))+
  geom_bar()+
  labs(
    title = 'Distirution of TOP MENU items selected at least once by a unique caller',
    x = 'TOP MENU options'
  )

ggplot(top_menu, aes(langId, fill = logInfo)) +
  geom_bar()+
  labs(
    title = 'Distirution of Languages divided by TOP MENU option
    1 = Amharic, 2=Oromiffa, 3=Tigrigna, 4=Wolayitta, and 5=Sidamigna',
    x = 'Language'
  )

#STARTING HERE IS FOR UNIQUE CALLS

top_menu_call <-filter(log_data, grepl("TOP MENU",logInfo))

#cleaning the axis
top_menu_call$logInfo<- str_replace(top_menu_call$logInfo, "TOP MENU - ", "")
top_menu_call$logInfo<- str_replace(top_menu_call$logInfo, " PRESSED", "")
top_menu_call$logInfo<- str_replace(top_menu_call$logInfo, " PRESSED", "")
top_menu_call$logInfo<- str_replace(top_menu_call$logInfo, " SELECTED", "")

top_menu_call$logInfo<- str_replace(top_menu_call$logInfo, "RAIN OPTION", "RAIN")
top_menu_call$logInfo<- str_replace(top_menu_call$logInfo, "HHI OPTION", "HHI")
top_menu_call$logInfo<- str_replace(top_menu_call$logInfo, "LIVESTOCK OPTION", "LIVESTOCK")
top_menu_call$logInfo<- str_replace(top_menu_call$logInfo, "COVID OPTION", "COVID")
top_menu_call$logInfo<- str_replace(top_menu_call$logInfo, "RESET PROFILE OPTION", "NON-NUMERIC KEY")
top_menu_call$logInfo<- str_replace(top_menu_call$logInfo, "TOP MENU REPLAYED", "NON-NUMERIC KEY")
top_menu_call$logInfo<- str_replace(top_menu_call$logInfo, "TOP MENU INVALID KEY", "NON-NUMERIC KEY")

top_menu_call <- top_menu_call %>%
  group_by(callId, logInfo) %>%
  count()

top_menu_call<- top_menu_call[match(unique(top_menu_call$callId), top_menu_call$callId),]

ggplot(top_menu_call, aes(x=fct_infreq(logInfo))) +
  theme(axis.text.x = element_text(angle = 30, hjust =1))+
  geom_bar(color='black', fill='#19723f')+
  geom_text(stat='count', aes(label=..count..), vjust=-1)+
  geom_text(aes(x='RAIN', y=200, label='Press 1'),color='#fcfff9')+
  geom_text(aes(x='HHI', y=200, label='Press 2'),color='#fcfff9')+
  geom_text(aes(x='LIVESTOCK', y=200, label='Press 3'),color='#fcfff9')+
  geom_text(aes(x='COVID', y=750, label='Press 4'),position = position_nudge(x=.3),color='black')+
  geom_text(aes(x='NON-NUMERIC KEY', y=200, label='Press #/*'),color='#fcfff9')+
  ylim(0,5000)+
  theme(axis.text.x = element_text(angle = 30, hjust =1),
         plot.background = element_rect(fill = "#fcfff9"),
        panel.background = element_rect(fill = "#fcfff9"),
        panel.grid.major = element_line(size=.1,colour = "black"),
        panel.grid.minor = element_line(size=.1,colour = "black"),
        panel.grid.major.x = element_blank(),
         panel.grid.minor.x = element_blank())+
  labs(
    title = 'Distribution of Options Selected',
    x = 'Top Menu Options',
    y='Frequency'
  )

```
 
 
 
**As we can easily see, the RAIN options and the HHI option dominate the choices from the top Menu. So, we decided to dive deeper into each of these menus to see if there are any outlier selections that are deep within the system. Additionally, ths distribution across languages seems to be fairly consistent at face value. We can run tests in the future, but for EDA this will be adequate. For 3/4 langauge options - having more data would be apprecaited**


### RAIN MENU

##### INCOMING CALL STARTED --> WELCOME MESSAGE PLAYED --> RANDOM EXPERIMENT --> TOP MENU --> RAIN MENU

**Here, we look at the breakdown of individuals who have selected a given option in the rain menu at least once. In the data, MAIN MENU == RAIN MENU.**


**RAIN MENU**

 - PRE PLANTING OPTION
 - PLANTING OPTION
 - CROP PROTECTION OPTION
 - FERTILIZGER SIDE DREESSING
 - POST HARVEST AND PROCESSING
 - REPEAT RAIN MENU
 - RETURN TO TOP MENU
 - INVALID KEY PRESSED (ADDITIONAL OUTCOME)



```{r}
# Pulling out the rain Menu By CALLLER

#RAIN == HHI_RAIN
rain_menu <- filter(log_data, grepl("MAIN MENU - ",logInfo))
rain_menu <- filter(rain_menu, !grepl("LIVESTOCK MAIN MENU",logInfo))
rain_menu <- filter(rain_menu, !grepl("HHI MAIN MENU",logInfo))
rain_menu <- filter(rain_menu, !grepl("COVID-19 MAIN MENU",logInfo))

#grouping the observations
rain_menu <-rain_menu %>%
  group_by(callerId, logInfo, langId) %>%
  count()

rain_menu$logInfo<- str_replace(rain_menu$logInfo, "MAIN MENU - ", "")
rain_menu$logInfo<- str_replace(rain_menu$logInfo, " SELECTED", "")
rain_menu$logInfo<- str_replace(rain_menu$logInfo, " PRESSED", "")
rain_menu$logInfo<- str_replace(rain_menu$logInfo, " OPTION", "")

#plotting rain menu breakdown
# ggplot(data=rain_menu, aes(x=logInfo)) +
#   theme(axis.text.x = element_text(angle = 30, hjust =1))+
#   geom_bar(fill='blue')+
#   labs(
#     title = 'Breakdown for Individuals By Content Selected at least Once from the rain menu',
#     x = 'Content Selected',
#     y= 'count'
#   )



#DOING IT BY CALL!!!!
rain_menu_call <- filter(log_data, grepl("MAIN MENU - ",logInfo))
rain_menu_call <- filter(rain_menu_call, !grepl("LIVESTOCK MAIN MENU",logInfo))
rain_menu_call <- filter(rain_menu_call, !grepl("HHI MAIN MENU",logInfo))
rain_menu_call <- filter(rain_menu_call, !grepl("COVID-19 MAIN MENU",logInfo))

#grouping the observations
rain_menu_call<-rain_menu_call %>%
  group_by(callId, logInfo,) %>%
  count()

rain_menu_call<- rain_menu_call[match(unique(rain_menu_call$callId), rain_menu_call$callId),]

rain_menu_call$logInfo<- str_replace(rain_menu_call$logInfo, "MAIN MENU - ", "")
rain_menu_call$logInfo<- str_replace(rain_menu_call$logInfo, " SELECTED", "")
rain_menu_call$logInfo<- str_replace(rain_menu_call$logInfo, " PRESSED", "")
rain_menu_call$logInfo<- str_replace(rain_menu_call$logInfo, " OPTION", "")


#FIxing the HHI menu and adding numbeers
rain_menu_call$logInfo<- str_replace(rain_menu_call$logInfo, "PRE PLANTING", "PREPLANTING")
rain_menu_call$logInfo<- str_replace(rain_menu_call$logInfo, "PLANTING", "PLANTING")
rain_menu_call$logInfo<- str_replace(rain_menu_call$logInfo, "CROP PROTECTION", "CROP PROTECTION")
rain_menu_call$logInfo<- str_replace(rain_menu_call$logInfo, "FERTILIZER SIDE DRESSING", "FERTILIZER DRESSING")
rain_menu_call$logInfo<- str_replace(rain_menu_call$logInfo, "POST HARVEST AND PROCESSING", "POST HARVEST")
rain_menu_call$logInfo<- str_replace(rain_menu_call$logInfo, "GO TO MAIN MENU", "NON-NUMERIC KEY")
rain_menu_call$logInfo<- str_replace(rain_menu_call$logInfo, "MAIN MENU REPLAYED", "NON-NUMERIC KEY")
rain_menu_call$logInfo<- str_replace(rain_menu_call$logInfo, "INVALID KEY", "NON-NUMERIC KEY")

#c7d0d8 - grey
#fcfff9 - cream
#19723f -
#plotting rain menu breakdown
ggplot(data=rain_menu_call, aes(x=fct_infreq(logInfo))) +
  geom_bar(color='black', fill='#c7d0d8',position = position_dodge( 0.3))+
  geom_text(stat='count', aes(label=..count..), vjust=-1)+
  geom_text(aes(x='PREPLANTING', y=120, label='Press 1'),color='black')+
  geom_text(aes(x='PLANTING', y=120, label='Press 2'),color='black')+
  geom_text(aes(x='CROP PROTECTION', y=120, label='Press 3'),color='black')+
  geom_text(aes(x='FERTILIZER DRESSING', y=120, label='Press 4'),color='black')+
  geom_text(aes(x='POST HARVEST', y=120, label='Press 5'),color='black')+
  geom_text(aes(x='NON-NUMERIC KEY', y=120, label='Press #/*'),color='black')+
  ylim(0,2800)+
  theme(axis.text.x = element_text(angle = 30, hjust =1,color='black'),
        plot.background = element_rect(fill = "#fcfff9"),
         panel.background = element_rect(fill = "#fcfff9"),
        panel.grid.major = element_line(size=.1,colour = "black"),
        panel.grid.minor = element_line(size=.1,colour = "black"),
        panel.grid.major.x = element_blank(),
        panel.grid.minor.x = element_blank())+
  labs(
    title = 'Distribution of Options Selected',
    x = 'Rain Menu Options',
    y='Frequency'
  )

#GETTING HHI MENU PER CALL
HHI_menu_call <- filter(log_data, grepl("HHI MAIN MENU - ",logInfo))

#grouping the observations
HHI_menu_call<-HHI_menu_call %>%
  group_by(callId, logInfo,) %>%
  count()

HHI_menu_call<- HHI_menu_call[match(unique(HHI_menu_call$callId), HHI_menu_call$callId),]

HHI_menu_call$logInfo<- str_replace(HHI_menu_call$logInfo, "HHI MAIN MENU - ", "")
HHI_menu_call$logInfo<- str_replace(HHI_menu_call$logInfo, " SELECTED", "")
HHI_menu_call$logInfo<- str_replace(HHI_menu_call$logInfo, " PRESSED", "")
HHI_menu_call$logInfo<- str_replace(HHI_menu_call$logInfo, " OPTION", "")


#FIxing the HHI menu and adding numbeers
HHI_menu_call$logInfo<- str_replace(HHI_menu_call$logInfo, "PRE PLANTING", "PREPLANTING")
HHI_menu_call$logInfo<- str_replace(HHI_menu_call$logInfo, "PLANTING AND TRANSPLANTING", "PLANTING")
HHI_menu_call$logInfo<- str_replace(HHI_menu_call$logInfo, "HARROWING AND EARTHNING", "HARROWING")
HHI_menu_call$logInfo<- str_replace(HHI_menu_call$logInfo, "IRRIGATING CROPS", "IRRIGATE CROPS")
HHI_menu_call$logInfo<- str_replace(HHI_menu_call$logInfo, "PROTECTING CROPS", "PROTECT CROPS")
HHI_menu_call$logInfo<- str_replace(HHI_menu_call$logInfo, "APPLYING FERTILIZER", "APPLY FERTILIZER")
HHI_menu_call$logInfo<- str_replace(HHI_menu_call$logInfo, "HARVESTING AND PROCESSING", "HARVESTING")
HHI_menu_call$logInfo<- str_replace(HHI_menu_call$logInfo, "GO TO MAIN MENU", "NON-NUMERIC KEY")
HHI_menu_call$logInfo<- str_replace(HHI_menu_call$logInfo, "HHI MAIN MENU REPLAYED", "NON-NUMERIC KEY")
HHI_menu_call$logInfo<- str_replace(HHI_menu_call$logInfo, "INVALID KEY", "NON-NUMERIC KEY")

# theme(plot.background = element_rect(fill = "#fcfff9"),
#         legend.background = element_rect(fill = "#fcfff9"),
#         panel.background = element_rect(fill = "#fcfff9"),
#         panel.grid.major = element_line(size=.1,colour = "black"))

#plotting rain menu breakdown
ggplot(data=HHI_menu_call, aes(x=fct_infreq(logInfo))) +
  geom_bar(color='black', fill='#19723f',position = position_dodge( 0.3))+
  geom_text(stat='count', aes(label=..count..), vjust=-1)+
  geom_text(aes(x='PREPLANTING', y=50, label='Press 1'),color='#fcfff9')+
  geom_text(aes(x='PLANTING', y=50, label='Press 2'),color='#fcfff9')+
  geom_text(aes(x='HARROWING', y=50, label='Press 3'),color='#fcfff9')+
  geom_text(aes(x='IRRIGATE CROPS', y=50, label='Press 4'),color='#fcfff9')+
  geom_text(aes(x='PROTECT CROPS', y=50, label='Press 5'),color='#fcfff9')+
  geom_text(aes(x='APPLY FERTILIZER', y=50, label='Press 6'),color='#fcfff9')+
  geom_text(aes(x='HARVESTING', y=50, label='Press 7'),color='#fcfff9')+
  geom_text(aes(x='NON-NUMERIC KEY', y=50, label='Press #/*'),color='#fcfff9')+
  ylim(0,1250)+
  theme(axis.text.x = element_text(angle = 30, hjust =1),
        plot.background = element_rect(fill = "#fcfff9"),
         panel.background = element_rect(fill = "#fcfff9"),
        panel.grid.major = element_line(size=.1,colour = "black"),
        panel.grid.minor = element_line(size=.1,colour = "black"),
        panel.grid.major.x = element_blank(),
        panel.grid.minor.x = element_blank())+
  labs(
    title = 'Distribution of Options Selected',
    x = 'HHI Menu Options',
    y='Frequency'
  )
```



**We can see that the pre-planting menu, which still has over 75% of unique users accesss it at least once expereinces incredibly high usage. So, we now dive into this menu. We will breakdown conent selection by language and overall**


### RAIN MENU/PRE PLANTING MENU

##### INCOMING CALL STARTED --> WELCOME MESSAGE PLAYED --> RANDOM EXPERIMENT --> 
##### TOP MENU --> RAIN MENU --> PRE PLANTING MENU

**Please note, the pre planting menu under the rain menu is referred to as MENU 1 in the data**


**PRE PLANTING MENU**

 - LAND PREPARATION
 - SEED VARIETY
 - REPEAT MENU
 - GO TO MAIN MENU (RAIN MENU)
 - INVALID KEY (ADDITIONAL OUTCOME)
 
 
```{r}


#filtering out MENU 1 options as the pre planting
MENU_1 <- filter(log_data, grepl("MENU 1",logInfo))
MENU_1 <- filter(MENU_1, !grepl("HHIMENU 1",logInfo))
MENU_1 <- filter(MENU_1, !grepl("APICULTURE MENU",logInfo))
MENU_1 <- filter(MENU_1, !grepl("APICULTURE SUB4 MENU",logInfo))
MENU_1 <- filter(MENU_1, !grepl("DAIRY MENU",logInfo))
MENU_1 <- filter(MENU_1, !grepl("SMALL-SCALE SUB5 MENU",logInfo))
MENU_1 <- filter(MENU_1, !grepl("DAIRY SUB2 MENU",logInfo))
MENU_1 <- filter(MENU_1, !grepl("FATTENING MANU",logInfo))

MENU_1 <- filter(MENU_1, !grepl("FATTENING SUB1 MENU",logInfo))
MENU_1 <- filter(MENU_1, !grepl("FATTENING SUB2 MENU",logInfo))
MENU_1 <- filter(MENU_1, !grepl("HOUSEHOLD MENU",logInfo))
MENU_1 <- filter(MENU_1, !grepl("HOUSEHOLD SUB1 MENU ",logInfo))


MENU_1 <- MENU_1 %>%
  group_by(callerId, logInfo, langId) %>%
  count()

MENU_1$logInfo<- str_replace(MENU_1$logInfo, "MENU 1 - ", "")
MENU_1$logInfo<- str_replace(MENU_1$logInfo, " PRESSED", "")
MENU_1$logInfo<- str_replace(MENU_1$logInfo, " SELECTED", "")

# plotting
ggplot(data=MENU_1, aes(x=logInfo)) +
  theme(axis.text.x = element_text(angle = 25, hjust= 1))+
  geom_bar(fill='cyan')+
  labs(
    title = 'Individuals By Content Selected at least Once from 
    RAIN MENU/PRE PLANTING OPTION',
    x = 'Content Selected',
    y= 'count'
  )



```


### RAIN MENU/PRE PLANTING MENU/LAND PREPARATION


**We continue our pattern of following the most accessed submenu from the previous subment - land preparation! This is also the bottom of a tree. We will breakdown conent selection by language and overall**


##### INCOMING CALL STARTED --> WELCOME MESSAGE PLAYED --> RANDOM EXPERIMENT --> 
##### TOP MENU --> RAIN MENU --> PRE PLANTING MENU --> LAND PREPARATION

**LAND PREPARATION**

 - BARLEY
 - MAIZE
 - SORGHUM
 - TEF
 - WHEAT
 - SESAME
 - FAVA BEAN
 - CHICKPEA
 - COMMON BEAN
 - COTTON

ORDER UNKOWN:

 - RICE
 - DURAME WHEAT
 - LENTIL
 - MALT BARLEY
 
 
```{r}
#GETTING THE CROP MENU FROM MENU 1 (rain/preplanting/land preparation sub menu)
land_prep <- filter(log_data, grepl("CONTENT PLAYED - LAND PREPARATION - ",logInfo))

land_prep_final <- land_prep %>%
  group_by(callerId, logInfo, langId) %>%
  count()

land_prep_final$logInfo<- str_replace(land_prep_final$logInfo, "CONTENT PLAYED - LAND PREPARATION -", "")

ggplot(data=land_prep_final, aes(x=logInfo)) +
  theme(axis.text.x = element_text(angle = 45, hjust=2))+
  geom_bar()+
  labs(
    title = 'RAIN MENU/PRE PLANTING/LAND PREPARATION
    content actually played by language',
    x = 'Content Played',
    y= 'count'
  )


#get rid of the language breakdown
land_prep_no_lang <- land_prep_final

land_prep_no_lang$logInfo<- str_replace(land_prep_no_lang$logInfo, "- AMHARIC", "")
land_prep_no_lang$logInfo<- str_replace(land_prep_no_lang$logInfo, "- OROMIFFA", "")
land_prep_no_lang$logInfo<- str_replace(land_prep_no_lang$logInfo, "- TIGRIGNA", "")
land_prep_no_lang$logInfo<- str_replace(land_prep_no_lang$logInfo, "- WOLAYITTA", "")
land_prep_no_lang$logInfo<- str_replace(land_prep_no_lang$logInfo, "- WOLAYTIGNA", "")
land_prep_no_lang$logInfo<- str_replace(land_prep_no_lang$logInfo, "- SIDAMIGNA", "")

ggplot(land_prep_no_lang, aes(x=logInfo)) +
  theme(axis.text.x = element_text(angle = 90))+
  geom_bar()+
  labs(
    title = 'RAIN MENU/PRE PLANTING/LAND PREPARATION
    content played overall',
    x = 'Content Played',
    y= 'count'
  )

ggplot(land_prep_no_lang, aes(langId, fill = logInfo)) +
  geom_bar()+
  labs(
    title = 'ALTERNATIVE RAIN MENU/PRE PLANTING/LAND PREPARATION
    content actually played by language
    1 = Amharic, 2=Oromiffa, 3=Tigrigna, 4=Wolayitta, and 5=Sidamigna
    ',
    x = 'Language'
  )
```
 

**BIG TAKEAWAY: 35% of users end up accessing the maize menu at some point! Wheat, Tef, Sorghum, and Barley also appear to be qualitatively significant**

**There is no menu to go deeper in, so let's go back up a level and check to see if other branches have a lot of access**


### RAIN MENU/PRE PLANTING MENU/SEED VARIETY


##### INCOMING CALL STARTED --> WELCOME MESSAGE PLAYED --> RANDOM EXPERIMENT --> 
##### TOP MENU --> RAIN MENU --> PRE PLANTING MENU --> SEED VARIETY

**SEED VARIETY**

 - BARLEY
 - MAIZE
 - SORGHUM
 - TEF
 - WHEAT
 - SESAME
 - FAVA BEAN
 - CHICKPEA
 - COMMON BEAN

```{r}
#GETTING THE CROP MENU FROM MENU 1 (rain/preplanting/seed variety sub menu)
seed_variety <- filter(log_data, grepl("CONTENT PLAYED - SEED VARITY",logInfo))

seed_variety_final <- seed_variety %>%
  group_by(callerId, logInfo, langId) %>%
  count()

seed_variety_final$logInfo<- str_replace(seed_variety_final$logInfo, "CONTENT PLAYED - SEED VARITY - ", "")

ggplot(data=seed_variety_final, aes(x=logInfo)) +
  theme(axis.text.x = element_text(angle = 45, hjust=1))+
  geom_bar()+
  labs(
    title = 'RAIN MENU/PRE PLANTING/SEED VARIETY
    content actually played by language',
    x = 'Content Selected',
    y= 'count'
  )


#get rid of the language breakdown
seed_variety_no_lang <- seed_variety_final

seed_variety_no_lang$logInfo<- str_replace(seed_variety_no_lang$logInfo, "- AMHARIC", "")
seed_variety_no_lang$logInfo<- str_replace(seed_variety_no_lang$logInfo, "- OROMIFFA", "")
seed_variety_no_lang$logInfo<- str_replace(seed_variety_no_lang$logInfo, "- TIGRIGNA", "")
seed_variety_no_lang$logInfo<- str_replace(seed_variety_no_lang$logInfo, "- WOLAYITTA", "")
seed_variety_no_lang$logInfo<- str_replace(seed_variety_no_lang$logInfo, "- WOLAYTIGNA", "")
seed_variety_no_lang$logInfo<- str_replace(seed_variety_no_lang$logInfo, "- SIDAMIGNA", "")

#alternative with langauge view
ggplot(seed_variety_no_lang, aes(langId, fill = logInfo)) +
  geom_bar()+
  labs(
    title = 'ALTERNATIVE RAIN MENU/PRE PLANTING/SEE VARIETY
    content actually played by language
    1 = Amharic, 2=Oromiffa, 3=Tigrigna, 4=Wolayitta, and 5=Sidamigna
    ',
    x = 'Language'
  )

#no language - overall
ggplot(seed_variety_no_lang, aes(x=logInfo)) +
  theme(axis.text.x = element_text(angle = 30, hjust=1))+
  geom_bar()+
  labs(
    title = 'RAIN MENU/PRE PLANTING/seed variety
    content actually played',
    x = 'Content Selected',
    y= 'count'
  )


```
 
**We have mostly exhausted the pre-planting option menu, and if we go back up to the original rain menu (aka MAIN MENU), we can see that planting also has a large porportion of users - over half**


### RAIN MENU/PLANTING MENU


##### INCOMING CALL STARTED --> WELCOME MESSAGE PLAYED --> RANDOM EXPERIMENT --> 
##### TOP MENU --> RAIN MENU --> PLANTING MENU

**The planting option as a subsection of the rain option is known as MENU 2 in the data**

PLANTING MENU

 - SEED RATE
 - SOIL DEPTH PLANTING
 - TRANSPLANTING
 - MOISTURE CONSERVATION
 - FERTILIZER APPLICATION
 - REPLAY MENY
 - RETURN TO RAIN MENY
 - INVALID KEY (ADDITIONAL OUTCOME)
 


```{r}
#PLANTING OPTION - second most accessed MENU 2
MENU_2 <- filter(log_data, grepl("MENU 2",logInfo))
MENU_2 <- filter(MENU_2, !grepl("HHIMENU 2",logInfo))
MENU_2 <- filter(MENU_2, !grepl("APICULTURE MENU",logInfo))
MENU_2 <- filter(MENU_2, !grepl("APICULTURE SUB2 MENU",logInfo))
MENU_2 <- filter(MENU_2, !grepl("DAIRY MENU",logInfo))
MENU_2 <- filter(MENU_2, !grepl("FATTENING MANU",logInfo))

MENU_2 <- MENU_2 %>%
  group_by(callerId, logInfo, langId) %>%
  count()

#cleaning
MENU_2$logInfo<- str_replace(MENU_2$logInfo, "MENU 2 - ", "")
MENU_2$logInfo<- str_replace(MENU_2$logInfo, " SELECTED", "")
MENU_2$logInfo<- str_replace(MENU_2$logInfo, " PRESSED", "")
MENU_2$logInfo<- str_replace(MENU_2$logInfo, " OPTION", "")


#plotting
ggplot(data=MENU_2, aes(x=fct_infreq(logInfo))) +
  theme(axis.text.x = element_text(angle = 45, hjust=1))+
  geom_bar(fill='olivedrab')+
  labs(
    title = 'Individuals By Content Selected at least Once from 
    RAIN MENU/PLANTING OPTION',
    x = 'Content Selected',
    y= 'count'
  )
```



**As per usual, we will go into the most common selection: seed rate!**

### RAIN MENU/PLANTING MENU/SEED RATE


##### INCOMING CALL STARTED --> WELCOME MESSAGE PLAYED --> RANDOM EXPERIMENT --> 
##### TOP MENU --> RAIN MENU --> PLANTING MENU --> SEED RATE


**SEED RATE**

 - BARLEY
 - MAIZE
 - SORGHUM
 - TEF
 - WHEAT
 - SESAME
 - FAVA BEAN
 - CHICKPEA
 - COMMON BEAN
 - COTTON

ORDER UNKOWN:

 - RICE
 - DURAME WHEAT
 - LENTIL
 - MALT BARLEY

```{r}
seed_rate <- filter(log_data, grepl("CONTENT PLAYED - SEED RATE",logInfo))

seed_rate_final <- seed_rate %>%
  group_by(callerId, logInfo, langId) %>%
  count()

seed_rate_final$logInfo<- str_replace(seed_rate_final$logInfo, "CONTENT PLAYED - SEED RATE -", "")

ggplot(data=seed_rate_final, aes(x=logInfo)) +
  theme(axis.text.x = element_text(angle = 45,hjust=1))+
  geom_bar()+
  labs(
    title = 'RAIN MENU/PLANTING/SEED RATE
    content actually played by language',
    x = 'Content Selected',
    y= 'count'
  )

#get rid of the language breakdown
seed_rate_no_lang <- seed_rate_final

seed_rate_no_lang$logInfo<- str_replace(seed_rate_no_lang$logInfo, "- AMHARIC", "")
seed_rate_no_lang$logInfo<- str_replace(seed_rate_no_lang$logInfo, "- OROMIFFA", "")
seed_rate_no_lang$logInfo<- str_replace(seed_rate_no_lang$logInfo, "- TIGRIGNA", "")
seed_rate_no_lang$logInfo<- str_replace(seed_rate_no_lang$logInfo, "- WOLAYITTA", "")
seed_rate_no_lang$logInfo<- str_replace(seed_rate_no_lang$logInfo, "- WOLAYTIGNA", "")
seed_rate_no_lang$logInfo<- str_replace(seed_rate_no_lang$logInfo, "- SIDAMIGNA", "")

#alternative with langauge view
ggplot(seed_rate_no_lang, aes(langId, fill = logInfo)) +
  geom_bar()+
  labs(
    title = 'ALTERNATIVE RAIN MENU/PLANTING/SEED RATE
    content actually played by language
    1 = Amharic, 2=Oromiffa, 3=Tigrigna, 4=Wolayitta, and 5=Sidamigna
    ',
    x = 'Language'
  )
#no language
ggplot(seed_rate_no_lang, aes(x=logInfo)) +
  theme(axis.text.x = element_text(angle = 45, hjust=1))+
  geom_bar()+
  labs(
    title = 'RAIN MENU/PLANTING/SEED RATE
    content actually played',
    x = 'Content Selected',
    y= 'count'
  )

```




```{r}
crop_menu <- log_data %>%
  filter(grepl("CROP MENU - ",logInfo)) %>%
  filter(!grepl("HHI",logInfo)) %>%
  filter(!grepl("REPLAYED",logInfo))

crop_menu <- crop_menu %>%
  group_by(callerId, logInfo, langId) %>%
  count()

crop_menu$logInfo<- str_replace(crop_menu$logInfo, "CROP MENU - ", "")
crop_menu$logInfo<- str_replace(crop_menu$logInfo, " SELECTED", "")
crop_menu$logInfo<- str_replace(crop_menu$logInfo, "GO TO", "")


ggplot(crop_menu, aes(x=logInfo)) +
  theme(axis.text.x = element_text(angle = 60, hjust =1, size = 7))+
  geom_bar()+
  labs(
    title = 'Crop menu breakdown',
    x = 'Crops',
    y= 'count'
  )

ggplot(crop_menu, aes(langId, fill = logInfo)) +
  geom_bar()+
  labs(
    title = 'CROP MENU BY LANGUAGE
    1 = Amharic, 2=Oromiffa, 3=Tigrigna, 4=Wolayitta, and 5=Sidamigna
    ',
    x = 'Language'
  )
num_crop_types <- data.frame(as.numeric(table(crop_menu$callerId)))
num_crop_types$frequencies <- num_crop_types$as.numeric.table.crop_menu.callerId.

summary(num_crop_types$frequencies)

ggplot(num_crop_types, aes(frequencies)) +
  geom_histogram(color="black", fill="red") +
  labs(
    title = 'Distribution of number crops ever selected by individual \n
      Min.  1st Qu.  Median    Mean   3rd Qu.    Max. 
  1.000     2.000     4.000      4.915     7.000     15.000 ',
    x = 'Number of crops selected '
  )
```


```{r}
#GETTING BOTH THE CROP MENUS for both rain and hhi
rain_crop_menu <- filter(log_data, grepl("CROP MENU - ",logInfo))
rain_crop_menu <- filter(rain_crop_menu, !grepl("HHI",logInfo))

rain_crop_menu$logInfo<- str_replace(rain_crop_menu$logInfo, "CROP MENU - ", "")
rain_crop_menu$logInfo<- str_replace(rain_crop_menu$logInfo, " SELECTED", "")
rain_crop_menu$logInfo<- str_replace(rain_crop_menu$logInfo, " PTION", "OPTION")


#ADDING THE NUMBERS
rain_crop_menu$logInfo<- str_replace(rain_crop_menu$logInfo, "BARLEY OPTION", "BARLEY")
rain_crop_menu$logInfo<- str_replace(rain_crop_menu$logInfo, "MAIZE OPTION", "MAIZE")
rain_crop_menu$logInfo<- str_replace(rain_crop_menu$logInfo, "SORGHUM OPTION", "SORGHUM")
rain_crop_menu$logInfo<- str_replace(rain_crop_menu$logInfo, "TEF OPTION", "TEF")
rain_crop_menu$logInfo<- str_replace(rain_crop_menu$logInfo, "DUREM WHEAT OPTION", "UNNUMBERED")
rain_crop_menu$logInfo<- str_replace(rain_crop_menu$logInfo, "MALT BARLEY", "UNNUMBERED")
rain_crop_menu$logInfo<- str_replace(rain_crop_menu$logInfo, "LENTIL", "UNNUMBERED")
rain_crop_menu$logInfo<- str_replace(rain_crop_menu$logInfo, "RICE", "UNNUMBERED")
rain_crop_menu$logInfo<- str_replace(rain_crop_menu$logInfo, "UNNUMBERED OPTION", "UNNUMBERED")
rain_crop_menu$logInfo<- str_replace(rain_crop_menu$logInfo, "WHEAT OPTION", "WHEAT")
rain_crop_menu$logInfo<- str_replace(rain_crop_menu$logInfo, "SESAME OPTION", "SESAME")
rain_crop_menu$logInfo<- str_replace(rain_crop_menu$logInfo, "FAVA BEAN OPTION", "FAVA BEAN")
rain_crop_menu$logInfo<- str_replace(rain_crop_menu$logInfo, "CHICKPEA OPTION", "CHICKPEA")
rain_crop_menu$logInfo<- str_replace(rain_crop_menu$logInfo, "COMMON BEANOPTION", "COMMON BEAN")
rain_crop_menu$logInfo<- str_replace(rain_crop_menu$logInfo, "COTTON OPTION", "COTTON")
rain_crop_menu$logInfo<- na_if(rain_crop_menu$logInfo, "COTTON")

rain_crop_menu$logInfo<- str_replace(rain_crop_menu$logInfo, "CROP MENU REPLAYED", "NON-NUMERIC KEY")
rain_crop_menu$logInfo<- str_replace(rain_crop_menu$logInfo, "GO TO MAIN MENU OPTION", "NON-NUMERIC KEY")

#fixes
rain_crop_menu$logInfo<- str_replace(rain_crop_menu$logInfo, "MALT 1 - ", "MALT ")
rain_crop_menu$logInfo<- str_replace(rain_crop_menu$logInfo, "DUREM 5 - ", "DUREM ")



#plotting rain
ggplot(rain_crop_menu %>% drop_na()  %>% filter(logInfo!='UNNUMBERED'), aes(x=fct_infreq(logInfo))) +
  geom_bar(color='black', fill='#c7d0d8',position = position_dodge( 0.3))+
  geom_text(stat='count', aes(label=..count..), vjust=-1)+
  geom_text(aes(x='BARLEY', y=200, label='Press 1'),color='black')+
  geom_text(aes(x='MAIZE', y=200, label='Press 2'),color='black')+
  geom_text(aes(x='SORGHUM', y=200, label='Press 3'),color='black')+
  geom_text(aes(x='TEF', y=200, label='Press 4'),color='black')+
  geom_text(aes(x='WHEAT', y=200, label='Press 5'),color='black')+
  geom_text(aes(x='SESAME', y=200, label='Press 6'),color='black')+
  geom_text(aes(x='FAVA BEAN', y=200, label='Press 7'),color='black')+
  geom_text(aes(x='CHICKPEA', y=200, label='Press 8'),color='black')+
  geom_text(aes(x='COMMON BEAN', y=200, label='Press 9'),color='black')+
  #geom_text(aes(x='COTTON', y=200, label='Press\n10'),color='black')+
  geom_text(aes(x='NON-NUMERIC KEY', y=200, label='Press #/*'),color='black')+
  theme(axis.text.x = element_text(angle = 30, hjust =1,color='black'),
         plot.background = element_rect(fill = "#fcfff9"),
         panel.background = element_rect(fill = "#fcfff9"),
         panel.grid.major = element_line(size=.1,colour = "black"),
         panel.grid.minor = element_line(size=.1,colour = "black"),
         panel.grid.major.x = element_blank(),
         panel.grid.minor.x = element_blank())+
  ylim(0,2500)+
  labs(
    title = 'Distribution of Options Selected',
    x = 'Rain Crop Menu Options',
    y= 'Frequency'
  )

# ggplot(data=rain_menu_call, aes(x=fct_infreq(logInfo))) +
#   geom_bar(color='black', fill='#c7d0d8',position = position_dodge( 0.3))+
#   geom_text(stat='count', aes(label=..count..), vjust=-1)+
#   geom_text(aes(x='PREPLANTING', y=120, label='Press 1'),color='black')+
#   geom_text(aes(x='PLANTING', y=120, label='Press 2'),color='black')+
#   geom_text(aes(x='CROP PROTECTION', y=120, label='Press 3'),color='black')+
#   geom_text(aes(x='FERTILIZER DRESSING', y=120, label='Press 4'),color='black')+
#   geom_text(aes(x='POST HARVEST', y=120, label='Press 5'),color='black')+
#   geom_text(aes(x='NON-NUMERIC KEY', y=120, label='Press #/*'),color='black')+
#   ylim(0,2800)+
#   theme(axis.text.x = element_text(angle = 30, hjust =1,color='black'),
#         plot.background = element_rect(fill = "#fcfff9"),
#          panel.background = element_rect(fill = "#fcfff9"),
#         panel.grid.major = element_line(size=.1,colour = "black"),
#         panel.grid.minor = element_line(size=.1,colour = "black"),
#         panel.grid.major.x = element_blank(),
#         panel.grid.minor.x = element_blank())+
#   labs(
#     title = 'Distirution of Rain Menu Options Selected per Call with Corresponding Button',
#     x = 'Rain Menu Options',
#     y='Number of Times Selected'
#   )



#getting the HHI MENU
hhi_crop_menu <- filter(log_data, grepl("HHICROP MENU - ",logInfo))
hhi_crop_menu$logInfo<- str_replace(hhi_crop_menu$logInfo, "HHICROP MENU - ", "")
hhi_crop_menu$logInfo<- str_replace(hhi_crop_menu$logInfo, " SELECTED", "")
table(hhi_crop_menu$logInfo)

#ADDING THE NUMBERS
hhi_crop_menu$logInfo<- str_replace(hhi_crop_menu$logInfo, "POTATO OPTION", "POTATO")
hhi_crop_menu$logInfo<- str_replace(hhi_crop_menu$logInfo, "CARROT OPTION", "CARROT")
hhi_crop_menu$logInfo<- str_replace(hhi_crop_menu$logInfo, "ONION OPTION", "ONION")
hhi_crop_menu$logInfo<- str_replace(hhi_crop_menu$logInfo, "GARLIC OPTION", "GARLIC")
hhi_crop_menu$logInfo<- str_replace(hhi_crop_menu$logInfo, "TOMATO OPTION", "TOMATO")
hhi_crop_menu$logInfo<- str_replace(hhi_crop_menu$logInfo, "PAPER OPTION", "PEPPER")
hhi_crop_menu$logInfo<- str_replace(hhi_crop_menu$logInfo, "HEAD CABBAGE OPTION", "HEAD CABBAGE")
hhi_crop_menu$logInfo<- str_replace(hhi_crop_menu$logInfo, "CROP MENU REPLAYED", "NON-NUMERIC KEY")
hhi_crop_menu$logInfo<- str_replace(hhi_crop_menu$logInfo, "GO TO MAIN MENU OPTION", "NON-NUMERIC KEY")
hhi_crop_menu$logInfo<- str_replace(hhi_crop_menu$logInfo, "INVALID KEY PRESSED", "NON-NUMERIC KEY")

#plotting HHI
ggplot(hhi_crop_menu, aes(x=fct_infreq(logInfo))) +
  geom_bar(color='black', fill='#19723f',position = position_dodge( 0.3))+
  geom_text(stat='count', aes(label=..count..), vjust=-1)+
  geom_text(aes(x='POTATO', y=70, label='Press 1'),color='#fcfff9')+
  geom_text(aes(x='CARROT', y=70, label='Press 2'),color='#fcfff9')+
  geom_text(aes(x='ONION', y=70, label='Press 3'),color='#fcfff9')+
  geom_text(aes(x='GARLIC', y=70, label='Press 4'),color='#fcfff9')+
  geom_text(aes(x='TOMATO', y=70, label='Press 5'),color='#fcfff9')+
  geom_text(aes(x='PEPPER', y=70, label='Press 6'),color='#fcfff9')+
  geom_text(aes(x='HEAD CABBAGE', y=70, label='Press 7'),color='#fcfff9')+
  geom_text(aes(x='NON-NUMERIC KEY', y=70, label='Press #/*'),color='#fcfff9')+
  ylim(0,1750)+
  theme(axis.text.x = element_text(angle = 30, hjust =1),
         plot.background = element_rect(fill = "#fcfff9"),
          panel.background = element_rect(fill = "#fcfff9"),
         panel.grid.major = element_line(size=.1,colour = "black"),
         panel.grid.minor = element_line(size=.1,colour = "black"),
         panel.grid.major.x = element_blank(),
         panel.grid.minor.x = element_blank())+
  labs(
    title = 'Distribution of Options Selected',
    x = 'HHI Crop Menu Options',
    y= 'Frequency'
  )



```


```{r}

# TOTAL CROPS BY CONENT PLAYEDE EVER!!!!
content_crop_played <- filter(log_data, grepl("CONTENT PLAYED - ",logInfo))
content_crop_played <- filter(content_crop_played, !grepl("LIVESTOCK",logInfo))
content_crop_played <- filter(content_crop_played, !grepl("APICULTURE",logInfo))
content_crop_played <- filter(content_crop_played, !grepl("COVID",logInfo))
content_crop_played <- filter(content_crop_played, !grepl("DAIRY",logInfo))
content_crop_played <- filter(content_crop_played, !grepl("FAMILY",logInfo))
content_crop_played <- filter(content_crop_played, !grepl("CATTLE",logInfo))
content_crop_played <- filter(content_crop_played, !grepl("FATTENING",logInfo))
content_crop_played <- filter(content_crop_played, !grepl("POULTRY",logInfo))
content_crop_played <- filter(content_crop_played, !grepl("SAFE",logInfo))
content_crop_played <- filter(content_crop_played, !grepl("MISCONCEPTIONS",logInfo))

#getting rid of the languages/content
content_crop_played$logInfo<- str_replace(content_crop_played$logInfo, "- AMHARIC", "")
content_crop_played$logInfo<- str_replace(content_crop_played$logInfo, "- OROMIFFA", "")
content_crop_played$logInfo<- str_replace(content_crop_played$logInfo, "- TIGRIGNA", "")
content_crop_played$logInfo<- str_replace(content_crop_played$logInfo, "- WOLAYITTA", "")
content_crop_played$logInfo<- str_replace(content_crop_played$logInfo, "- WOLAYTIGNA", "")
content_crop_played$logInfo<- str_replace(content_crop_played$logInfo, "- SIDAMIGNA", "")
content_crop_played$logInfo<- str_replace(content_crop_played$logInfo, "CONTENT PLAYED - ", "")

#getting rid of menu labels
content_crop_played$logInfo<- str_replace(content_crop_played$logInfo, "APPLYING FERTILIZER - ", "")
content_crop_played$logInfo<- str_replace(content_crop_played$logInfo, "DISEASE CONTROL - ", "")
content_crop_played$logInfo<- str_replace(content_crop_played$logInfo, "FERTILIZER APPLICATION RATE - ", "")
content_crop_played$logInfo<- str_replace(content_crop_played$logInfo, "FERTILIZER SIDE DRESSING - ", "")
content_crop_played$logInfo<- str_replace(content_crop_played$logInfo, "HARROWING AND EARTHNING UP - ", "")
content_crop_played$logInfo<- str_replace(content_crop_played$logInfo, "HARVESTING - ", "")
content_crop_played$logInfo<- str_replace(content_crop_played$logInfo, "HARVESTING TECHNIQUE - ", "")
content_crop_played$logInfo<- str_replace(content_crop_played$logInfo, "HOW TO ADD WATER - ", "")
content_crop_played$logInfo<- str_replace(content_crop_played$logInfo, "HOW TO PLANT - ", "")
content_crop_played$logInfo<- str_replace(content_crop_played$logInfo, "HOW TO SELECT AND BUY SEEDS - ", "")
content_crop_played$logInfo<- str_replace(content_crop_played$logInfo, "INSECT CONTROL - ", "")
content_crop_played$logInfo<- str_replace(content_crop_played$logInfo, "LAND PREPARATION - ", "")
content_crop_played$logInfo<- str_replace(content_crop_played$logInfo, "MANAGING WEEDS - ", "")
content_crop_played$logInfo<- str_replace(content_crop_played$logInfo, "MOISTURE CONSERVATION - ", "")
content_crop_played$logInfo<- str_replace(content_crop_played$logInfo, "OPTIMUM SPACING BETWEEN ROWS AND PLANTS - ", "")
content_crop_played$logInfo<- str_replace(content_crop_played$logInfo, "PLOT PREPARATION - ", "")
content_crop_played$logInfo<- str_replace(content_crop_played$logInfo, "PRE-IRRIGATION - ", "")
content_crop_played$logInfo<- str_replace(content_crop_played$logInfo, "PROCESSING - ", "")
content_crop_played$logInfo<- str_replace(content_crop_played$logInfo, "\\(", "")
content_crop_played$logInfo<- str_replace(content_crop_played$logInfo, "\\)", "")
content_crop_played$logInfo<- str_replace(content_crop_played$logInfo, "PROCESSING HHI - ", "")
content_crop_played$logInfo<- str_replace(content_crop_played$logInfo, "PROTECTION ON INSECTS AND DISEASES - ", "")
content_crop_played$logInfo<- str_replace(content_crop_played$logInfo, "SEED RATE - ", "")
content_crop_played$logInfo<- str_replace(content_crop_played$logInfo, "SEED VARITY - ", "")
content_crop_played$logInfo<- str_replace(content_crop_played$logInfo, "SEED VARITY -", "")
content_crop_played$logInfo<- str_replace(content_crop_played$logInfo, "SOIL DEPTH - ", "")
content_crop_played$logInfo<- str_replace(content_crop_played$logInfo, "SOIL DEPTH -", "")
content_crop_played$logInfo<- str_replace(content_crop_played$logInfo, "THRESHING AND CLEANING - ", "")
content_crop_played$logInfo<- str_replace(content_crop_played$logInfo, "TRANSPLANTING - ", "")
content_crop_played$logInfo<- str_replace(content_crop_played$logInfo, "WEED CONTROL - ", "")
content_crop_played$logInfo<- str_replace(content_crop_played$logInfo, "WHEN AND HOW MUCH WATER TO ADD - DEGA - CLAY - ", "")
content_crop_played$logInfo<- str_replace(content_crop_played$logInfo, "HEN AND HOW MUCH WATER TO ADD - DEGA - LOAM - ", "")
content_crop_played$logInfo<- str_replace(content_crop_played$logInfo, "WHEN AND HOW MUCH WATER TO ADD - KOLA - CLAY - ", "")
content_crop_played$logInfo<- str_replace(content_crop_played$logInfo, "WHEN AND HOW MUCH WATER TO ADD - KOLA - SAND - ", "")
content_crop_played$logInfo<- str_replace(content_crop_played$logInfo, "WHEN AND HOW MUCH WATER TO ADD - DEGA - SAND - ", "")
content_crop_played$logInfo<- str_replace(content_crop_played$logInfo, "WHEN AND HOW MUCH WATER TO ADD - KOLA - LOAM - ", "")
content_crop_played$logInfo<- str_replace(content_crop_played$logInfo, "WHEN AND HOW MUCH WATER TO ADD - WOYENADEGA - CLAY - ", "")
content_crop_played$logInfo<- str_replace(content_crop_played$logInfo, "WHEN AND HOW MUCH WATER TO ADD - WOYENADEGA - LOAM - ", "")
content_crop_played$logInfo<- str_replace(content_crop_played$logInfo, "WHEN AND HOW MUCH WATER TO ADD - WOYENADEGA - SAND - ", "")
content_crop_played$logInfo<- str_replace(content_crop_played$logInfo, "WHEN TO HARVEST - ", "")

#fixing extra changes
content_crop_played$logInfo<- str_replace_all(content_crop_played$logInfo, " ", "")
content_crop_played$logInfo<- str_replace_all(content_crop_played$logInfo, "WC", "C")
content_crop_played$logInfo<- str_replace_all(content_crop_played$logInfo, "WG", "G")
content_crop_played$logInfo<- str_replace_all(content_crop_played$logInfo, "WO", "O")
content_crop_played$logInfo<- str_replace_all(content_crop_played$logInfo, "WP", "P")
content_crop_played$logInfo<- str_replace_all(content_crop_played$logInfo, "WT", "T")
content_crop_played$logInfo<- str_replace_all(content_crop_played$logInfo, "WHEADCABBAGE", "HEADCABBAGE")

#ADDING THE NUMBERS
#ADDING THE NUMBERS
content_crop_played$logInfo<- str_replace(content_crop_played$logInfo, "POTATO", "1 - POTATO")
content_crop_played$logInfo<- str_replace(content_crop_played$logInfo, "CARROT", "2 - CARROT")
content_crop_played$logInfo<- str_replace(content_crop_played$logInfo, "ONION", "3 - ONION")
content_crop_played$logInfo<- str_replace(content_crop_played$logInfo, "GARLIC", "4 - GARLIC")
content_crop_played$logInfo<- str_replace(content_crop_played$logInfo, "TOMATO", "5 - TOMATO")
content_crop_played$logInfo<- str_replace(content_crop_played$logInfo, "PEPPER", "6 - PEPPER OPTION")
content_crop_played$logInfo<- str_replace(content_crop_played$logInfo, "HEADCABBAGE", "7 - HEAD CABBAGE")


content_crop_played$logInfo<- str_replace(content_crop_played$logInfo, "BARLEY", "1 - BARLEY")
content_crop_played$logInfo<- str_replace(content_crop_played$logInfo, "MAIZE", "2 - MAIZE")
content_crop_played$logInfo<- str_replace(content_crop_played$logInfo, "SORGHUM", "3 - SORGHUM")
content_crop_played$logInfo<- str_replace(content_crop_played$logInfo, "TEF", "4 - TEF")
content_crop_played$logInfo<- str_replace(content_crop_played$logInfo, "WHEAT", "5 - WHEAT")
content_crop_played$logInfo<- str_replace(content_crop_played$logInfo, "SESAME", "6 - SESAME")
content_crop_played$logInfo<- str_replace(content_crop_played$logInfo, "FAVA BEANS", "7 - FAVA BEAN")
content_crop_played$logInfo<- str_replace(content_crop_played$logInfo, "CHICKPEA", "8 - CHICKPEA")
content_crop_played$logInfo<- str_replace(content_crop_played$logInfo, "COMMONBEANS", "9 - COMMON BEANS")
content_crop_played$logInfo<- str_replace(content_crop_played$logInfo, "COTTON", "10 - COTTON")

content_crop_played$logInfo<- str_replace(content_crop_played$logInfo, "DURAME5 - WHEAT", "DURAME WHEAT")
content_crop_played$logInfo<- str_replace(content_crop_played$logInfo, "MALT1 - BARLEY", "MALT BARLEY")



?geom_text
ggplot(content_crop_played, aes(x=fct_infreq(logInfo))) +
  theme(axis.text.x = element_text(angle = 60, hjust =1, size = 7))+
  geom_bar(fill='sky blue')+
  geom_text(stat='count', aes(label=..count..), vjust=-1,size=3)+
  ylim(0,2750)+
  labs(
    title = 'ALL Crops Ever Accessed Across All Calls with Labeled Buttons',
    x = 'Crops',
    y= 'count'
  )
```





#What about a nice crop breakdown per month?
```{r}

crop_month <- log_data %>%
  filter(grepl("CROP MENU - ",logInfo)) %>%
  filter(!grepl("HHI",logInfo)) %>%
  filter(!grepl("REPLAYED",logInfo))

crop_month <- crop_month %>%
  group_by(callerId, logInfo,month) %>%
  count()

crop_month$logInfo<- str_replace(crop_month$logInfo, "CROP MENU - ", "")
crop_month$logInfo<- str_replace(crop_month$logInfo, " SELECTED", "")
crop_month$logInfo<- str_replace(crop_month$logInfo, "GO TO", "")


crop_track <- crop_month %>%
  filter(month == 1)
ggplot(crop_track, aes(x=logInfo)) +
  theme(axis.text.x = element_text(angle = 60, hjust =1, size = 7))+
  geom_bar()+
  labs(
    title = 'Crop menu breakdown Jan',
    x = 'Crops',
    y= 'count'
  )
  
crop_track <- crop_month %>%
  filter(month == 2)
ggplot(crop_track, aes(x=logInfo)) +
  theme(axis.text.x = element_text(angle = 60, hjust =1, size = 7))+
  geom_bar()+
  labs(
    title = 'Crop menu breakdown feb',
    x = 'Crops',
    y= 'count'
  )
crop_track <- crop_month %>%
  filter(month == 3)
ggplot(crop_track, aes(x=logInfo)) +
  theme(axis.text.x = element_text(angle = 60, hjust =1, size = 7))+
  geom_bar()+
  labs(
    title = 'Crop menu breakdown mar',
    x = 'Crops',
    y= 'count'
  )
crop_track <- crop_month %>%
  filter(month == 4)
ggplot(crop_track, aes(x=logInfo)) +
  theme(axis.text.x = element_text(angle = 60, hjust =1, size = 7))+
  geom_bar()+
  labs(
    title = 'Crop menu breakdown april',
    x = 'Crops',
    y= 'count'
  )
crop_track <- crop_month %>%
  filter(month == 5)
ggplot(crop_track, aes(x=logInfo)) +
  theme(axis.text.x = element_text(angle = 60, hjust =1, size = 7))+
  geom_bar()+
  labs(
    title = 'Crop menu breakdown may',
    x = 'Crops',
    y= 'count'
  )
crop_track <- crop_month %>%
  filter(month == 6)
ggplot(crop_track, aes(x=logInfo)) +
  theme(axis.text.x = element_text(angle = 60, hjust =1, size = 7))+
  geom_bar()+
  labs(
    title = 'Crop menu breakdown june',
    x = 'Crops',
    y= 'count'
  )
crop_track <- crop_month %>%
  filter(month == 7)
ggplot(crop_track, aes(x=logInfo)) +
  theme(axis.text.x = element_text(angle = 60, hjust =1, size = 7))+
  geom_bar()+
  labs(
    title = 'Crop menu breakdown july',
    x = 'Crops',
    y= 'count'
  )
crop_track <- crop_month %>%
  filter(month == 8)
ggplot(crop_track, aes(x=logInfo)) +
  theme(axis.text.x = element_text(angle = 60, hjust =1, size = 7))+
  geom_bar()+
  labs(
    title = 'Crop menu breakdown aug',
    x = 'Crops',
    y= 'count'
  )
crop_track <- crop_month %>%
  filter(month == 9)
ggplot(crop_track, aes(x=logInfo)) +
  theme(axis.text.x = element_text(angle = 60, hjust =1, size = 7))+
  geom_bar()+
  labs(
    title = 'Crop menu breakdown sep',
    x = 'Crops',
    y= 'count'
  )
crop_track <- crop_month %>%
  filter(month == 10)
ggplot(crop_track, aes(x=logInfo)) +
  theme(axis.text.x = element_text(angle = 60, hjust =1, size = 7))+
  geom_bar()+
  labs(
    title = 'Crop menu breakdown oct',
    x = 'Crops',
    y= 'count'
  )
crop_track <- crop_month %>%
  filter(month == 11)
ggplot(crop_track, aes(x=logInfo)) +
  theme(axis.text.x = element_text(angle = 60, hjust =1, size = 7))+
  geom_bar()+
  labs(
    title = 'Crop menu breakdown nov',
    x = 'Crops',
    y= 'count'
  )
crop_track <- crop_month %>%
  filter(month == 12)
ggplot(crop_track, aes(x=logInfo)) +
  theme(axis.text.x = element_text(angle = 60, hjust =1, size = 7))+
  geom_bar()+
  labs(
    title = 'Crop menu breakdown dec',
    x = 'Crops',
    y= 'count'
  )


```

